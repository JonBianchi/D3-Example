<!DOCTYPE html>
<meta charset="utf-8">
<svg width="960" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>



d3.json("https://raw.githubusercontent.com/JonBianchi/D3-Example/main/data/data.json", function(data) {


  var playersByQuarter = d3.nest()
  .key(function(d) { return d.quarter; })
  .entries(data);
  console.log(playersByQuarter)


  var groupData = d3.nest()
    .key(function(d) { return d.name + d.quarter; })
  	.rollup(function(d, i){
      
      var d2 = {Name: d[0].name, Quarter: d[0].quarter}
      d.forEach(function(d){
        d2["Series1"] = d.Series1
        d2["Series2"] = d.Series2
      })
      console.log("rollup d", d, d2);
    	return d2;
    })
    .entries(data)
  	.map(function(d){ return d.value; });


//console.log(data)
var series = d3.stack()
    .keys(["Series1","Series2"])
    .offset(d3.stackOffsetDiverging)
    (groupData);

var svg = d3.select("svg"),
    margin = {top: 20, right: 30, bottom: 30, left: 60},
    width = +svg.attr("width"),
    height = +svg.attr("height");


    var x0 = d3.scaleBand()
    .rangeRound([0, width])
    .paddingInner(0.1);

    var x1 = d3.scaleBand()
    .padding(0.05);


    x0.domain(data.map(function(d) { return d.quarter; }));
    x1.domain(data.map(function(d) { return d.name; }))
    .rangeRound([0, x0.bandwidth()])
  	.padding(0.2);



var y = d3.scaleLinear()
    .domain([d3.min(series, stackMin), d3.max(series, stackMax)])
    .rangeRound([height - margin.bottom, margin.top]);


// Color hex codes
var z = d3.scaleOrdinal()
    .range(["#228C22","#C41F3E"])


svg.append("g")
  .selectAll("g")
  .data(series)
  .enter().append("g")
    .attr("fill", function(d) { return z(d.key); })
  .selectAll("rect")
  .data(function(d) { return d; })
  .enter().append("rect")
    .attr("width", x.bandwidth)
    .attr("x", function(d) { return x(d.data.name); })
    .attr("y", function(d) { return y(d[1]); })
    .attr("height", function(d) { return y(d[0]) - y(d[1]); })

svg.append("g")
    .attr("transform", "translate(0," + y(0) + ")")
    .call(d3.axisBottom(x));

svg.append("g")
    .attr("transform", "translate(" + margin.left + ",0)")
    .call(d3.axisLeft(y));


});


function stackMin(serie) {
  return d3.min(serie, function(d) { return d[0]; });
}

function stackMax(serie) {
  return d3.max(serie, function(d) { return d[1]; });
}

</script>